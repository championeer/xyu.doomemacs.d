#+TITLE: XYUçš„Doom Emacs é…ç½®

* ä¸ªäººä¿¡æ¯
** ç”¨äºåŠ å¯†ç­‰
#+begin_src emacs-lisp
(setq user-full-name "Jason Chao"
      user-mail-address "jason@chao.com")
#+end_src
* UI é…ç½®
** è®¾ç½® doom themeã€è¡Œå·ç­‰
#+begin_src emacs-lisp
(setq doom-theme 'doom-vibrant)
(setq display-line-numbers-type t) ;;è¡Œå·
(global-visual-line-mode 1) ;;æ¢è¡Œ
;;ç¾åŒ–buffer name
(setq doom-fallback-buffer-name "â–º Doom"
      +doom-dashboard-name "â–º Doom")
;;å­—ä½“
(setq doom-font (font-spec :family "Source Code Pro" :size 15)
      doom-big-font (font-spec :family "Source Code Pro" :size 30)
      doom-variable-pitch-font (font-spec :family "Source Code Variable" :size 15)
      doom-unicode-font (font-spec :family "JuliaMono")
      doom-serif-font (font-spec :family "TeX Gyre Cursor")
      )
;;
;;(defun xyu/doom-init-ui-misc()
;;  (menu-bar-mode -1)               ;; disable menu-bar
;;  (setq-default cursor-type 'box)  ;; set box style cursor
;;  (blink-cursor-mode -1)           ;; cursor not blink
;;  <<doom-dashboard-layout>>
;;  (if (display-graphic-p)
;;      (progn
        ;; NOTE: ONLY GUI
        ;; set font
;;        (dolist (charset '(kana han symbol cjk-misc bopomofo gb18030))
;;          (set-fontset-font (frame-parameter nil 'font) charset
;;                            (font-spec :family "Source Han Mono")))
;;        (appendq! face-font-rescale-alist
;;                  '(("Source Han Mono" . 1.2)
;;                   ))
;;        <<doom-image-banner>>
        ;; random banner image from bing.com, NOTE: https://emacs-china.org/t/topic/264/33
;;        )
;;    (progn
      ;; NOTE: ONLY TUI
;;      <<doom-ascii-banner>>
;;      )))
;;(add-hook! 'doom-init-ui-hook #'xyu/doom-init-ui-misc)
;;
#+end_src
** å¯åŠ¨çª—å£å¤§å°
#+begin_src emacs-lisp
(pushnew! initial-frame-alist '(width . 220) '(height . 80))
#+end_src
** doom dashboard é…ç½®ï¼ˆå¯åŠ¨ä¸»é¡µï¼‰
#+begin_src emacs-lisp
;;æ–°çš„dashboard
(map! :map +doom-dashboard-mode-map
      :desc "org agenda" "a" #'org-agenda
      :desc "find file" "f" #'find-file
      :desc "recent session" "R" #'doom/quickload-session
      :desc "recent files" "r" #'counsel-recentf
      :desc "config dir" "C" #'doom/open-private-config
      :desc "open config.org" "c" (cmd! (find-file (expand-file-name "config.org" doom-private-dir)))
      ;; :desc "open dotfile" "." (cmd! (doom-project-find-file "~/.config/"))
      ;;:desc "notes (roam)" "n" #'org-roam-node-find
      :desc "switch buffer" "b" #'+vertico/switch-workspace-buffer
      ;; :desc "switch buffers (all)" "B" #'consult-buffer
      :desc "ibuffer" "i" #'ibuffer
      ;;:desc "open project" "p" #'counsel-projectile-switch-project
      ;; :desc "set theme" "t" #'consult-theme
      :desc "quit" "q" #'save-buffers-kill-terminal
      :desc "documentation" "H" #'doom/help
      :desc "show keybindings" "h" (cmd! (which-key-show-major-mode)))
;;å»é™¤è€çš„dashboard
(remove-hook '+doom-dashboard-functions
             #'doom-dashboard-widget-shortmenu)
(add-hook! '+doom-dashboard-mode-hook (hide-mode-line-mode 1)
           (hl-line-mode 1))
#+end_src
** doom-modeline é…ç½®
#+begin_src emacs-lisp
;;é»˜è®¤ä¿®æ”¹ä¸­çš„æ–‡ä»¶åé¢œè‰²æ˜¯çº¢è‰²ï¼Œè¿™é‡Œæ”¹ä¸ºorange
(custom-set-faces!
  '(doom-modeline-buffer-modified :foreground "orange"))
;;å°†modelineçš„é«˜åº¦ä»é»˜è®¤çš„25æ”¹ä¸º45
(setq doom-modeline-height 45)
;; å½“æ–‡ä»¶ä¸æ˜¯utfç¼–ç æ—¶æ‰æ˜¾ç¤ºæç¤ºï¼Œå¦åˆ™éšè—
(defun doom-modeline-conditional-buffer-encoding ()
  "We expect the encoding to be LF UTF-8, so only show the modeline when this is not the case"
  (setq-local doom-modeline-buffer-encoding
              (unless (and (memq (plist-get (coding-system-plist buffer-file-coding-system) :category)
                                 '(coding-category-undecided coding-category-utf-8))
                           (not (memq (coding-system-eol-type buffer-file-coding-system) '(1 2))))
                t)))

(add-hook 'after-change-major-mode-hook #'doom-modeline-conditional-buffer-encoding)
;;è®¾ç½®modelineä¸­å±•ç¤ºçš„å†…å®¹
(after! doom-modeline
  (custom-set-variables '(doom-modeline-buffer-file-name-style 'relative-to-project)
                        '(doom-modeline-major-mode-icon t)
                        '(doom-modeline-modal-icon nil))
  (nyan-mode t))
;; open dashboard
(map! :leader :desc "Dashboard" "d" #'+doom-dashboard/open)
#+end_src
* é€šç”¨é…ç½®
** è‡ªåŠ¨ä¿å­˜
#+begin_src emacs-lisp
(setq auto-save-visited-mode t)
(auto-save-visited-mode +1)
(setq auto-revert-use-notify nil)
#+end_src
** Evil æ¨¡å¼ä¸‹åœ¨çª—å£é—´å¿«é€Ÿç§»åŠ¨
#+begin_src emacs-lisp
(map! :map evil-window-map
      "SPC" #'rotate-layout
      ;; æ–¹å‘
      "<left>"   #'evil-window-left
      "<down>"   #'evil-window-down
      "<up>"     #'evil-window-up
      "<right>"  #'evil-window-right
      ;; äº¤æ¢çª—å£
      "C-<left>"   #'+evil/window-move-left
      "C-<down>"   #'+evil/window-move-down
      "C-<up>"     #'+evil/window-move-up
      "C-<right>"  #'+evil/window-move-right
      )
#+end_src
* Org-mode é…ç½®
** Org é»˜è®¤ç›®å½•
#+begin_src emacs-lisp
(setq org-directory "~/Org-Notes/")
#+end_src
** ç¾åŒ– Org
#+begin_src emacs-lisp
(add-hook 'org-mode-hook
          (lambda ()
            (variable-pitch-mode 1)
            visual-line-mode))
;;
(setq org-hide-emphasis-markers t
      org-fontify-done-headline t
      org-odd-levels-only t
      ;;org-hide-leading-stars t
      org-pretty-entities t)
;;æ›´æ”¹å±‚çº§åˆ—è¡¨çš„æ ·å¼
(setq org-list-demote-modify-bullet '(("+" . "-") ("-" . "+") ("*" . "+") ("1." . "a.")))
#+end_src
** è®¾ç½® TODO çš„é»˜è®¤é…ç½®
(t)ä»£è¡¨å¿«æ·å­—æ¯ï¼›!ä»£è¡¨æ—¶é—´æˆ³ï¼›@ä»£è¡¨ä¸€ä¸ªæœ‰æ—¶é—´æˆ³çš„è®°å½•ç¬”è®°
#+begin_src emacs-lisp
(after! org (setq org-todo-keywords
      '((sequence "TODO(t)" "IN-PROGRESS(i)" "WAITING(w)" "DELEGATED(e!)" "|" "DONE(d@/!)" "CANCELED(c@/!)"))))
#+end_src
** è®¾ç½® Org-agenda
*** é…ç½®å¯æ£€ç´¢çš„ Agenda æ–‡ä»¶
#+begin_src emacs-lisp
(setq org-agenda-files
      (quote ("~/Org-Notes/" "~/Org-Notes/work/" "~/Org-Notes/personal/")))
;;è®¾ç½®é»˜è®¤çš„è§†å›¾æ¨¡å¼ï¼Œdoomé»˜è®¤ä¸ºweekè§†å›¾ï¼Œæ­¤é…ç½®æš‚æ—¶å±è”½
;;(setq org-agenda-span 'week)
;;(setq org-agenda-span 'day)
#+end_src
*** å­¦ä¹  ç½‘ä¸Šè®¾ç½®ï¼Œè®¾ç½®æ–°çš„ agenda ç½‘æ ¼ï¼Œä»¥ 3 å°æ—¶ä¸ºä¸€å•å…ƒ
#+begin_src emacs-lisp
(setq org-agenda-time-grid (quote ((daily today require-timed)
                                   (300
                                    600
                                    900
                                    1200
                                    1500
                                    1800
                                    2100
                                    2400)
                                   "......"
                                   "-----------------------------------------------------"
                                   )))
#+end_src
*** æ—¥è®°é…ç½®
#+begin_src emacs-lisp
;;è®¾ç½®locationï¼Œä»¥ä¾¿è®¡ç®—æ—¥å‡ºæ—¥è½æ—¶é—´
(setq calendar-longitude 116.9962)
(setq calendar-latitude 39.91)
;;è®¡ç®—sunriseå’Œsunsetçš„æ—¶é—´
(defun diary-sunrise ()
  (let ((dss (diary-sunrise-sunset)))
    (with-temp-buffer
      (insert dss)
      (goto-char (point-min))
      (while (re-search-forward " ([^)]*)" nil t)
        (replace-match "" nil nil))
      (goto-char (point-min))
      (search-forward ",")
      (buffer-substring (point-min) (match-beginning 0)))))

(defun diary-sunset ()
  (let ((dss (diary-sunrise-sunset))
        start end)
    (with-temp-buffer
      (insert dss)
      (goto-char (point-min))
      (while (re-search-forward " ([^)]*)" nil t)
        (replace-match "" nil nil))
      (goto-char (point-min))
      (search-forward ", ")
      (setq start (match-end 0))
      (search-forward " at")
      (setq end (match-beginning 0))
      (goto-char start)
      (capitalize-word 1)
      (buffer-substring start end))))
;;diaryæ–‡ä»¶ä½ç½®
(setq org-agenda-include-diary t)
(setq org-agenda-diary-file "~/Org-Notes/personal/mydiary")
(setq diary-file "~/Org-Notes/personal/mydiary")
#+end_src
*** ä¹ æƒ¯é…ç½®
#+begin_src emacs-lisp
(add-to-list 'org-modules 'org-habit t)
(setq org-habit-graph-column t)
#+end_src
*** Caputre æ¨¡æ¿é…ç½®
#+begin_src emacs-lisp
;;è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨äºå®šä½everyday.orgä¸­çš„å‡ ä¸ªå…³é”®headingçš„ä½ç½®
(defun my-org-goto-last-worklog-headline ()
  "Move point to the last headline in file matching \"* WORKLOG\"."
  (end-of-buffer)
  (re-search-backward "\\* WORKLOG"))

(defun my-org-goto-last-event-headline ()
  "Move point to the last headline in file matching \"* EVENTS\"."
  (end-of-buffer)
  (re-search-backward "\\* EVENTS"))

(defun my-org-goto-last-lifelog-headline ()
  "Move point to the last headline in file matching \"* LIFELOG\"."
  (end-of-buffer)
  (re-search-backward "\\* LIFELOG"))

;; org-captureæ¨¡æ¿
(after! org (setq org-capture-templates
      '(("t" "TASK" entry (file+headline "work/task.org" "Tasks")
         "* TODO %i%? [/] :@work: \n %U\n From: %a\n")
        ("n" "NOTE" entry (file "note.org")
         "* %i%? :NOTE: \n created on %T\n From: %a\n")
        ("m" "MEETING" entry (file+headline "work/meeting.org" "Meetings")
         "* TODO %i%? :MEETING:@work: \n created on %U\n")
        ("w" "WORKLOG" entry
         (file+function "everyday.org"
                        my-org-goto-last-worklog-headline)
         "* %i%? :@work: \n%T")
        ("l" "LIFELOG" entry
         (file+function "everyday.org"
                        my-org-goto-last-lifelog-headline)
         "* %i%? :@life: \n%T")
        ("e" "EVENT" entry
         (file+function "everyday.org"
                        my-org-goto-last-event-headline)
         "* %i%? \n%T"))))

#+end_src
*** newday å‡½æ•°ï¼Œç”¨äºåœ¨ everyday.org ä¸­æ’å…¥æ—¥ç»“æ„
#+begin_src emacs-lisp
(defun newday ()
  (interactive)
  (progn
    (find-file "~/Org-Notes/everyday.org")
    (goto-char (point-max))
    (insert "*" ?\s (format-time-string "%Y-%m-%d %A") ?\n
            "** PLAN\n"
            "** WORKLOG\n"
            "** LIFELOG\n"
            "** EVENTS\n"
            "** REVIEW\n"
            "*** ä»Šå¤©æœ€å¤§çš„æˆæœä»€ä¹ˆï¼Ÿ \n"
            "*** ä»Šå¤©æœ‰ä»€ä¹ˆæƒŠå–œï¼Ÿ \n"
            "*** ä»Šå¤©æœ‰ä»€ä¹ˆéœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ \n"
            )))
#+end_src
** ç®€åŒ–æ–‡ä»¶æ’å…¥é“¾æ¥
#+begin_src emacs-lisp
(defun +org-insert-file-link ()
  "Insert a file link.  At the prompt, enter the filename."
  (interactive)
  (insert (format "[[%s]]" (org-link-complete-file))))
;;
(map! :after org
      :map org-mode-map
      :localleader
      "l f" #'+org-insert-file-link)
#+end_src
* DIRED é…ç½®

* å…¶ä»–åŒ…é…ç½®
** ivy-richï¼šæ˜¾ç¤ºå‘½ä»¤çš„è¯¦ç»†æè¿°
#+begin_src emacs-lisp
(require 'ivy-rich)
(ivy-rich-mode 1)
(setcdr (assq t ivy-format-functions-alist) #'ivy-format-function-line)
#+end_src
** find-file-in-projectï¼šé™ˆæ–Œçš„æ’ä»¶ï¼Œç”¨äºåœ¨é¡¹ç›®ä¸­å¿«é€Ÿæ‰¾åˆ°æ–‡ä»¶
#+begin_src emacs-lisp
(require 'find-file-in-project)
(ivy-mode 1)
(setq ffip-project-root "~/Org-Notes")
#+end_src
** Eros
#+begin_quote
æ¥è‡ª:tool eval
#+end_quote
#+begin_src emacs-lisp
(setq eros-eval-result-prefix "âŸ¹ ") ; default =>
#+end_src
** Company
æ¥è‡ª:completion company
#+begin_src emacs-lisp
(after! company
  (setq company-idle-delay 0.5
        company-minimum-prefix-length 2)
  (setq company-show-numbers t)
  (add-hook 'evil-normal-state-entry-hook #'company-abort)) ;; make aborting less annoying.
;;å¢å¼ºhistory
(setq-default history-length 1000)
(setq-default prescient-history-length 1000)
#+end_src
** YASnippets
æ¥è‡ª:editor snippetsï¼Œå¼€å¯ snippets åµŒå¥—æ”¯æŒ
#+begin_src emacs-lisp
(setq yas-triggers-in-field t)
#+end_src
** Smart Parentheses
æ¥è‡ª:core packagesï¼Œå¢åŠ  org-mode çš„é…å¯¹
#+begin_src emacs-lisp
(sp-local-pair
 '(org-mode)
 "<<" ">>"
 :actions '(insert))
#+end_src
** Keycast
åœ¨ modeline ä¸­æ˜¾ç¤ºæŒ‰é”®
#+begin_src emacs-lisp
(use-package! keycast
    :ensure t
    :commands (keycast-mode)
    :config
    (setq keycast-separator-width 1)
    (setq keycast-mode-line-remove-tail-elements nil)
    (setq keycast-mode-line-insert-after 'mode-line-buffer-identification)
    (dolist (input '(self-insert-command
                     org-self-insert-command))
      (add-to-list 'keycast-substitute-alist `(,input "." "Typingâ€¦")))
    (dolist (event '(mouse-event-p
                     mouse-movement-p
                     mwheel-scroll))
      (add-to-list 'keycast-substitute-alist `(,event nil))))
#+end_src
** Org-modern
ä¸€ä¸ª org æ ·å¼ç¾åŒ–åŒ…
#+begin_src emacs-lisp
(use-package! org-modern
  :hook (org-mode . org-modern-mode)
  :config
  (setq org-modern-star '("â—‰" "â—‹" "âœ¸" "âœ¿" "âœ¤" "âœœ" "â—†" "â–¶")
        org-modern-table-vertical 1
        org-modern-table-horizontal 0.2
        org-modern-list '((43 . "â¤")
                          (45 . "â€“")
                          (42 . "â€¢"))
        org-modern-todo-faces
        '(("TODO" :inverse-video t :inherit org-todo)
          ("PROJ" :inverse-video t :inherit +org-todo-project)
          ("STRT" :inverse-video t :inherit +org-todo-active)
          ("[-]"  :inverse-video t :inherit +org-todo-active)
          ("HOLD" :inverse-video t :inherit +org-todo-onhold)
          ("WAIT" :inverse-video t :inherit +org-todo-onhold)
          ("[?]"  :inverse-video t :inherit +org-todo-onhold)
          ("KILL" :inverse-video t :inherit +org-todo-cancel)
          ("NO"   :inverse-video t :inherit +org-todo-cancel))
        org-modern-footnote
        (cons nil (cadr org-script-display))
        org-modern-block-fringe nil
        org-modern-block-name
        '((t . t)
          ("src" "Â»" "Â«")
          ("example" "Â»â€“" "â€“Â«")
          ("quote" "â" "â")
          ("export" "â©" "âª"))
        org-modern-progress nil
        org-modern-priority nil
        org-modern-horizontal-rule (make-string 36 ?â”€)
        org-modern-keyword
        '((t . t)
          ("title" . "ğ™")
          ("subtitle" . "ğ™©")
          ("author" . "ğ˜¼")
          ("email" . #("îƒ¡" 0 1 (display (raise -0.14))))
          ("date" . "ğ˜¿")
          ("property" . "â˜¸")
          ("options" . "âŒ¥")
          ("startup" . "â»")
          ("macro" . "ğ“œ")
          ("bind" . #("î…—" 0 1 (display (raise -0.1))))
          ("bibliography" . "ï…")
          ("print_bibliography" . #("î•‹" 0 1 (display (raise -0.1))))
          ("cite_export" . "ï…â®­")
          ("print_glossary" . #("î•‹á´¬á¶»" 0 1 (display (raise -0.1))))
          ("glossary_sources" . #("î“" 0 1 (display (raise -0.14))))
          ("include" . "â‡¤")
          ("setupfile" . "â‡š")
          ("html_head" . "ğŸ…·")
          ("html" . "ğŸ…—")
          ("latex_class" . "ğŸ„»")
          ("latex_class_options" . #("ğŸ„»î¢¸" 1 2 (display (raise -0.14))))
          ("latex_header" . "ğŸ…»")
          ("latex_header_extra" . "ğŸ…»âº")
          ("latex" . "ğŸ…›")
          ("beamer_theme" . "ğŸ„±")
          ("beamer_color_theme" . #("ğŸ„±îŠ" 1 2 (display (raise -0.12))))
          ("beamer_font_theme" . "ğŸ„±ğ€")
          ("beamer_header" . "ğŸ…±")
          ("beamer" . "ğŸ…‘")
          ("attr_latex" . "ğŸ„›")
          ("attr_html" . "ğŸ„—")
          ("attr_org" . "â’ª")
          ("call" . #("î•¦" 0 1 (display (raise -0.15))))
          ("name" . "â")
          ("header" . "â€º")
          ("caption" . "â˜°")
          ("results" . "ğŸ ¶")))
  (custom-set-faces! '(org-modern-statistics :inherit org-checkbox-statistics-todo)))
#+end_src
